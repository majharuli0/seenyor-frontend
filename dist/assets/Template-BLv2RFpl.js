const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DataAnalysis-CCjVaxRP.js","assets/index-CR4fhODd.js","assets/index-BCO3KllJ.css","assets/MoonFilled-BfbWhEbe.js","assets/barChart-CY3WFCIy.js","assets/multibarChart-CJYqVdI-.js","assets/TimelineGraph-BGn7goh8.js","assets/TimelineBar-CqxX7qCV.js","assets/LiveRateChart-3xwLo1Bm.js","assets/SkeletonRateChart-B_Yg2cAZ.js","assets/DayRateChart-cGibqCKw.js","assets/scatterChart-ZrN1IDd9.js"])))=>i.map(i=>d[i]);
import{r as s,S as he,bO as xe,j as i,m as ue,i as z,D as P,k4 as _e,k1 as ve,aa as M,k7 as X,jB as Z,cS as w,J as De,k8 as ge,B as Ee}from"./index-CR4fhODd.js";import{W as Se}from"./WeeklyMonthlyPicker-BRoXS4CI.js";import{aC as Te}from"./SleepHynogram-DfUa7E06.js";import{R as se}from"./FileOutlined-CocyS7bT.js";const je=()=>Array.from({length:12},(v,D)=>({date:`2023-10-${String(D*2+1).padStart(2,"0")}`,value:Math.floor(Math.random()*100)+1})),be=()=>Array.from({length:12},(v,D)=>({date:`2023-10-${String(D*2+2).padStart(2,"0")}`,value:Math.floor(Math.random()*100)+1})),Re=()=>Array.from({length:12},(v,D)=>({date:`2023-10-${String(D*2+1).padStart(2,"0")}`,value:Math.floor(Math.random()*180)+1}));je();be();Re();function Me(v,D){return typeof v!="function"?(console.error("apiFunction is not a function or is undefined"),Promise.reject(new Error("apiFunction is not a function"))):v(D).then(E=>E).catch(E=>{throw console.error("API Request Error:",E),E})}M.lazy(()=>w(()=>import("./DataAnalysis-CCjVaxRP.js"),__vite__mapDeps([0,1,2,3])));const we=M.lazy(()=>w(()=>import("./barChart-CY3WFCIy.js"),__vite__mapDeps([4,1,2]))),y=M.lazy(()=>w(()=>import("./multibarChart-CJYqVdI-.js"),__vite__mapDeps([5,1,2])));M.lazy(()=>w(()=>import("./TimelineGraph-BGn7goh8.js"),__vite__mapDeps([6,1,2])));const Ce=M.lazy(()=>w(()=>import("./TimelineBar-CqxX7qCV.js"),__vite__mapDeps([7,1,2])));M.lazy(()=>w(()=>import("./LiveRateChart-3xwLo1Bm.js"),__vite__mapDeps([8,1,2])));const ke=M.lazy(()=>w(()=>import("./SkeletonRateChart-B_Yg2cAZ.js").then(v=>v.a),__vite__mapDeps([9,1,2]))),Ae=M.lazy(()=>w(()=>import("./DayRateChart-cGibqCKw.js"),__vite__mapDeps([10,1,2]))),Ne=M.lazy(()=>w(()=>import("./scatterChart-ZrN1IDd9.js"),__vite__mapDeps([11,1,2]))),{RangePicker:Be,DatePicker:Ye}=P;function Y(v){const[D,E,e]=v.split(":").map(Number);return D*60+E+e/60}function pe({visible:v,onClose:D,modalData:E,summaryProps:e}){var G;const[x,A]=s.useState(""),[f,B]=s.useState(""),[j,p]=s.useState(null),[C,b]=s.useState([]),[k,L]=s.useState([]),[$,H]=s.useState([]),{sleepEventsType:F,sleepEventsColor:W}=s.useContext(he),m=s.useContext(xe),{elderlyDetails:N}=m||{};function ee(t){A(t.end),B(t.start),p("weeklyMonthly")}function te(t,a){A(a[1]||""),B(a[0]||""),p("range")}function ne(t,a){A(null),B(a||""),p("day")}function U(t){return t.map(({date:a,events:n})=>{const c=n.reduce((o,{event_type:l})=>(o[l]=(o[l]||0)+1,o),{}),d=Object.entries(c).map(([o,l])=>({name:F[o],value:`${l}`,status:o,color:W[o]}));return{date:a,data:d}})}function ae(t){return Array.isArray(t)?t.map(n=>{var d;const c=((d=n.sleep_index_common_list)==null?void 0:d.reduce((o,l)=>{const R=Number(l==null?void 0:l.value)||0;return o+R},0))||"0";return{date:(n==null?void 0:n.date)||null,bed_exit_duration:c}}):(console.error("Invalid data format: Expected an array."),[])}function le(t){return t.map(n=>{const c=n.sleep_index_common_list.reduce((d,o)=>d+parseInt(o.value,10),0);return{date:n.date,totalFallAsleepDuration:c}})}function ie(t){const a=[];return t==null||t.forEach(n=>{var d;const c=n.date;(d=n==null?void 0:n.events)==null||d.forEach(o=>{if(o.event_type===14||o.event_type===15){const l=a.find(R=>R.date===c);l?l.anomalyHeartRate+=1:a.push({date:c,anomalyHeartRate:1})}})}),a}function oe(t){const a=[];return console.log(t),t==null||t.forEach(n=>{var o,l,R,O,I,V;const d={date:z(n.datestr).subtract(1,"day").format("YYYY-MM-DD"),data:[]};((o=n==null?void 0:n.user_activity)==null?void 0:o.static_duration)!==void 0&&d.data.push({name:"still_time",value:Y((l=n==null?void 0:n.user_activity)==null?void 0:l.static_duration),status:"30"}),((R=n==null?void 0:n.user_activity)==null?void 0:R.walk_duration)!==void 0&&d.data.push({name:"walking_duration",value:Y((O=n==null?void 0:n.user_activity)==null?void 0:O.walk_duration),status:"31"}),((I=n==null?void 0:n.user_activity)==null?void 0:I.other_duration)!==void 0&&d.data.push({name:"other_duration",value:Y((V=n==null?void 0:n.user_activity)==null?void 0:V.other_duration),status:"32"}),a.push(d)}),a}function ce(t){var n,c,d,o,l,R,O,I,V,K,Q;let a=[];if(t||H([]),(e==null?void 0:e.title)==="Breath Rate Summary"||(e==null?void 0:e.title)==="Heart Rate Summary")!x&&((n=t[0])!=null&&n.avg)&&(a=[{name:"Avg. Breath Rate",value:(c=t[0])==null?void 0:c.avg},{name:"Min. Breath Rate",value:(d=t[0])==null?void 0:d.min},{name:"Max. Breath Rate",value:(o=t[0])==null?void 0:o.max}]);else if((e==null?void 0:e.title)==="Sleep Timeline Summary")if((l=t[0])!=null&&l.statistical_data&&f&&x==null){console.log(t[0]);const g=(R=t[0])==null?void 0:R.statistical_data.reduce((u,h)=>{const r=new Date(h.start_time),T=(new Date(h.end_time)-r)/(1e3*60),_=F[h.status];return u[_]||(u[_]={duration:0}),u[_].duration+=T,u},{});a=Object.entries(g).map(([u,{duration:h}])=>{const r=Math.floor(h/60),S=Math.floor(h%60);return{name:u,value:`${r}hr ${S}m`}}),a=[{name:"Fell Asleep",value:Z((O=t[0])==null?void 0:O.sleep_st_idx)},...a,{name:"Bed Exit After Sleep",value:((I=t[0])==null?void 0:I.leave_bed_count)+"x"},{name:"Woke up",value:Z((V=t[0])==null?void 0:V.sleep_ed_idx)}]}else{const g={},u=t.map(h=>({data:h.sleep_index_common_list,date:h.date}));u==null||u.forEach(h=>{var r;(r=h==null?void 0:h.data)==null||r.forEach(({name:S,value:T,status:_,ratio:fe})=>{g[_]||(g[_]={name:`Avg. ${F[_]}`,totalValue:0,totalRatio:0,count:0}),g[_].totalValue+=parseInt(T),g[_].totalRatio+=fe,g[_].count+=1})}),a=Object.entries(g).map(([h,r])=>{const S=Math.round(r.totalValue/r.count),T=Math.floor(S/60),_=S%60;return{name:r.name,value:`${T}hr ${_}m`,ratio:Math.round(r.totalRatio/r.count)}})}else if((e==null?void 0:e.title)==="Sleep Events Summary")if((K=t[0])!=null&&K.events&&f&&x==null)a=(Q=t[0])==null?void 0:Q.events.reduce((u,h)=>{const r=F[h.event_type],S=u.find(T=>T.name===r);if(S){const T=parseInt(S.value.replace("x",""));S.value=`${T+1}x`}else u.push({name:r,value:"1x",color:W[r]});return u},[]);else{const g={},u=U(t);u==null||u.forEach(h=>{var r;(r=h==null?void 0:h.data)==null||r.forEach(({name:S,value:T,status:_})=>{g[_]||(g[_]={name:`Avg. ${F[_]}`,totalValue:0,count:0}),g[_].totalValue+=parseInt(T),g[_].count+=1})}),a=Object.entries(g).map(([h,r])=>{const S=Math.round(r.totalValue/r.count);return{name:r.name,value:`${S}x`}})}return H(a),a}function q(t){if(t||b([]),(e==null?void 0:e.title)==="Sleep Timeline Summary")if(f&&x){const a=t.map(n=>({data:n.sleep_index_common_list,date:n.date}));b(a)}else b(t[0]);else if((e==null?void 0:e.title)==="Sleep Events Summary"){const a=U(t);b(a)}else if((e==null?void 0:e.title)==="Daily Breathing Rate Summary"||(e==null?void 0:e.title)==="Daily Heart Rate Summary"){if(x&&f){const a={xdata:t.map(n=>n.date),maxArray:t.map(n=>n.max),minArray:t.map(n=>n.min),allAvgNumber:Math.round(t.reduce((n,c)=>n+c.avg,0)/t.length)};b(a)}}else{if((e==null?void 0:e.title)==="Time Spent Out of Bed Summary")return ae(t);if((e==null?void 0:e.title)==="Time to Fall Asleep Summary")return le(t);if((e==null?void 0:e.title)==="Heart Rate Variation Overview Summary")return ie(t);if((e==null?void 0:e.title)==="Room Occupancy Duration Overview Summary"){const a=oe(t);b(a)}}return t}s.useEffect(()=>{async function t(){var c,d,o;if(!v||!x&&j!=="day"||!f||!((c=e==null?void 0:e.apisProps)!=null&&c.endpoint))return;let a=f,n=x;j==="day"&&(a=f?z(f).subtract(1,"day").format("YYYY-MM-DD"):"",n=a);try{const l=await Me((d=e==null?void 0:e.apisProps)==null?void 0:d.endpoint,{...(o=e==null?void 0:e.apisProps)==null?void 0:o.query,elderly_id:N==null?void 0:N._id,from_date:n,to_date:a});l&&(l!=null&&l.data)&&(L(q(l==null?void 0:l.data)),ce(l==null?void 0:l.data),q(l==null?void 0:l.data))}catch(l){console.error("Error fetching summary data:",l),L([])}}t()},[(G=e==null?void 0:e.apisProps)==null?void 0:G.endpoint,x,f,v,j,N==null?void 0:N._id]);const de=()=>{var t;return(t=e==null?void 0:e.pickerTypes)==null?void 0:t.map(a=>{switch(a){case"weeklyMonthly":return i.jsx(Se,{placeholder:"Weekly/Monthly",style:{width:"140px",borderRadius:"10px"},handleChnage:ee,value:j==="weeklyMonthly"&&f&&x?{start:f,end:x}:null},"weeklyMonthly");case"range":return i.jsx(Be,{showTime:!1,style:{width:"200px",borderRadius:"10px"},size:"large",placeholder:["Pick Data Range (Start)","End"],format:"YYYY-MM-DD",onChange:(n,c)=>te(n,c),value:j==="range"&&x&&f?[z(f),z(x)]:null,allowClear:!0},"range");case"day":return i.jsx(P,{style:{width:"200px",borderRadius:"10px"},size:"large",format:"YYYY-MM-DD",onChange:(n,c)=>ne(n,c),value:j==="day"&&f?z(f):null,allowClear:!0},"day");default:return null}})},J={multibar:{default:{component:y,getProps:()=>({data:C,toDate:x,fromDate:f,valueType:e==null?void 0:e.dataType})},day:{component:Te,getProps:()=>({sleepData:C==null?void 0:C.statistical_data,height:300})}},multibar_sleep_events:{default:{component:y,getProps:()=>({data:C,toDate:x,fromDate:f,valueType:e==null?void 0:e.dataType})},day:{component:Ce,getProps:()=>{var t,a,n;return{alarmEvents:(t=k[0])==null?void 0:t.events,enterBedTime:X((a=k[0])==null?void 0:a.get_bed_idx),getupAfterTime:X((n=k[0])==null?void 0:n.leave_bed_idx)}}}},bar:{default:{component:we,getProps:()=>({data:k,dataType:e==null?void 0:e.dataType,color:e==null?void 0:e.color,xUnit:e==null?void 0:e.xUnit,toDate:e!=null&&e.isFromToDate?x:"",fromDate:e!=null&&e.isFromToDate?f:"",numberLimit:e==null?void 0:e.numberLimit,dataUnit:e==null?void 0:e.dataUnit,chartFor:e==null?void 0:e.chartFor})}},rate:{default:{component:ke,getProps:()=>({cheartInfo:C,color:e==null?void 0:e.color,dateType:"Month",fromDate:f,toDate:x})},day:{component:Ae,getProps:()=>{var t,a;return{data:((t=k[0])==null?void 0:t.data_list)||[],timestamp:((a=k[0])==null?void 0:a.timestamps)||[],color:e==null?void 0:e.color,type:e==null?void 0:e.dataType}}}},scatter:{default:{component:Ne,getProps:()=>({data:(e==null?void 0:e.title)!=="Bed Exit Time Trends Summary"?_e(k):ve(k),colors:{gotobed:"#2EC7C9",wakeup:"#5AB1EF",getup:"#FFB980",fallasleep:"#B6A2DE",bedexit:"#508C9B"}})}}},re=()=>{var d,o;const t=e==null?void 0:e.chartType,a=((d=J[t])==null?void 0:d[j])||((o=J[t])==null?void 0:o.default);if(!a)return null;const{component:n,getProps:c}=a;return i.jsx(s.Suspense,{fallback:i.jsx("div",{children:"Loading..."}),children:i.jsx(n,{...c()})})};return i.jsx(ue,{open:v,onCancel:D,footer:null,width:"100%",style:{height:"100vh",padding:0,borderRadius:0,top:0},className:"!rounded-none summaryModal !h-[100vh] overflow-hidden",children:i.jsxs("div",{className:"p-4 h-[100vh]",children:[i.jsxs("div",{className:"flex flex-col justify-center items-center mb-4 gap-2",children:[i.jsx("h2",{className:"text-2xl font-bold text-primary",children:e==null?void 0:e.title}),i.jsx("div",{id:"DatePickers",className:"flex gap-4 items-center justify-center mt-4",children:de()})]}),$.length>0&&i.jsx("div",{id:"chartTotal",className:"flex w-full flex-wrap items-center justify-center border-b mt-12",children:$.map((t,a,n)=>i.jsx(Fe,{label:t.name,value:t.value,isFirst:a===0,isLast:a===n.length-1},a))}),i.jsx("div",{className:"report-content max-h-[350px]  w-[90%] mt-16 mx-auto",children:re()})]})})}const Fe=({label:v,value:D,isFirst:E,isLast:e})=>i.jsxs("div",{id:"totalItem",className:`max-w-[200px] w-fit border p-1 px-6 flex items-center justify-center border-b-[0.5px] flex-col ${E&&e?"rounded-tl-xl rounded-tr-xl":E?"rounded-tl-xl":e?"rounded-tr-xl":""}`,children:[i.jsx("h1",{className:"text-2xl font-bold text-primary text-nowrap",children:D}),i.jsx("span",{className:"text-sm font-medium opacity-80 text-primary text-nowrap",children:v})]});function Le({children:v,title:D,color:E,icon:e,description:x,dataAnalysis:A,isDataAnalysis:f=!0,isSummaryBtn:B=!0,summaryProps:j,headerClassName:p}){const[C,b]=s.useState(!1);return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex flex-col gap-6 p-6 bg-white rounded-2xl !w-full h-full ",children:[i.jsxs("div",{id:"header",className:"flex justify-between items-center w-full",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{style:{color:E,fontSize:"24px"},children:e}),i.jsx("h1",{className:`text-[21px] font-bold text-primary ${p}`,children:D}),x&&i.jsx(De,{title:x,children:i.jsx(ge,{style:{fontSize:"16px",color:"#000",cursor:"pointer"}})})]}),B&&i.jsx(Ee,{onClick:()=>b(!0),icon:i.jsx(se,{}),size:"large",children:"Summary"})]}),i.jsx("div",{className:"h-full",children:v}),f&&A!==""&&i.jsxs("div",{id:"footer",className:"flex gap-3 items-center p-2 px-3",children:[i.jsx("div",{id:"icon",style:{color:"white",fontSize:"20px",backgroundColor:E},className:"p-2 rounded-full",children:e}),i.jsx("span",{className:"text-[15px] capitalize",children:A})]})]}),i.jsx(pe,{visible:C,onClose:()=>b(!1),summaryProps:{...j,color:E,icon:e}})]})}export{Le as T};
