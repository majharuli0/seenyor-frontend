import{bB as Pe,bC as X,ae as ze,af as Be,aj as ee,ai as Te,bD as Ee,ak as He,r,ab as Ye,bE as Ue,bF as Ve,bG as Ge,bH as We,ad as q,aa as $,bI as Xe,ap as qe,at as Je,bJ as Ke,bK as Ze,bL as Qe,bM as et,j as e,aU as Y,bb as ae,m as tt,s as U,B as T,bN as de,bO as ve,J,bP as re,bQ as st,bR as te,bS as ot,bT as nt,bU as it,bV as be,bW as at,bX as rt,bY as lt,bZ as ct,b_ as je,b$ as P,c0 as dt,c1 as ye,c2 as mt,c3 as Ne,c4 as we,c5 as _e,c6 as Ce,c7 as ft,c8 as Se,c9 as Ie,ca as $e,cb as ut,T as xt,cc as pt,cd as Re,ce as le,cf as gt,S as se,cg as ht,i as B,t as De,aH as vt,ch as bt,bz as jt,ci as yt,u as Nt,cj as ke,ck as Me,cl as fe,cm as Ae,cn as wt,C as _t,D as Ct,co as St,cp as It,aL as $t,cq as Rt,cr as ue,cs as W,ct as Dt,cu as kt,cv as Mt,cw as At,cx as Lt,cy as Ot,cz as Ft,cA as Pt,cB as Z,cC as zt,cD as Bt,cE as Tt,cF as Et,cG as Ht}from"./index-CR4fhODd.js";import{S as Yt}from"./index-5u-uvn5B.js";import{B as Q}from"./Breadcrumb-CqeJypm4.js";import"./Steps-DqoGLFw9.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Vt=Pe("circle",Ut),Gt=t=>{const{componentCls:s,notificationMarginEdge:o,animationMaxHeight:n}=t,u=`${s}-notice`,c=new X("antNotificationFadeIn",{"0%":{transform:"translate3d(100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}}),m=new X("antNotificationTopFadeIn",{"0%":{top:-n,opacity:0},"100%":{top:0,opacity:1}}),h=new X("antNotificationBottomFadeIn",{"0%":{bottom:t.calc(n).mul(-1).equal(),opacity:0},"100%":{bottom:0,opacity:1}}),g=new X("antNotificationLeftFadeIn",{"0%":{transform:"translate3d(-100%, 0, 0)",opacity:0},"100%":{transform:"translate3d(0, 0, 0)",opacity:1}});return{[s]:{[`&${s}-top, &${s}-bottom`]:{marginInline:0,[u]:{marginInline:"auto auto"}},[`&${s}-top`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:m}},[`&${s}-bottom`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:h}},[`&${s}-topRight, &${s}-bottomRight`]:{[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:c}},[`&${s}-topLeft, &${s}-bottomLeft`]:{marginRight:{value:0,_skip_check_:!0},marginLeft:{value:o,_skip_check_:!0},[u]:{marginInlineEnd:"auto",marginInlineStart:0},[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationName:g}}}}},Wt=["top","topLeft","topRight","bottom","bottomLeft","bottomRight"],Xt={topLeft:"left",topRight:"right",bottomLeft:"left",bottomRight:"right",top:"left",bottom:"left"},qt=(t,s)=>{const{componentCls:o}=t;return{[`${o}-${s}`]:{[`&${o}-stack > ${o}-notice-wrapper`]:{[s.startsWith("top")?"top":"bottom"]:0,[Xt[s]]:{value:0,_skip_check_:!0}}}}},Jt=t=>{const s={};for(let o=1;o<t.notificationStackLayer;o++)s[`&:nth-last-child(${o+1})`]={overflow:"hidden",[`& > ${t.componentCls}-notice`]:{opacity:0,transition:`opacity ${t.motionDurationMid}`}};return Object.assign({[`&:not(:nth-last-child(-n+${t.notificationStackLayer}))`]:{opacity:0,overflow:"hidden",color:"transparent",pointerEvents:"none"}},s)},Kt=t=>{const s={};for(let o=1;o<t.notificationStackLayer;o++)s[`&:nth-last-child(${o+1})`]={background:t.colorBgBlur,backdropFilter:"blur(10px)","-webkit-backdrop-filter":"blur(10px)"};return Object.assign({},s)},Zt=t=>{const{componentCls:s}=t;return Object.assign({[`${s}-stack`]:{[`& > ${s}-notice-wrapper`]:Object.assign({transition:`transform ${t.motionDurationSlow}, backdrop-filter 0s`,willChange:"transform, opacity",position:"absolute"},Jt(t))},[`${s}-stack:not(${s}-stack-expanded)`]:{[`& > ${s}-notice-wrapper`]:Object.assign({},Kt(t))},[`${s}-stack${s}-stack-expanded`]:{[`& > ${s}-notice-wrapper`]:{"&:not(:nth-last-child(-n + 1))":{opacity:1,overflow:"unset",color:"inherit",pointerEvents:"auto",[`& > ${t.componentCls}-notice`]:{opacity:1}},"&:after":{content:'""',position:"absolute",height:t.margin,width:"100%",insetInline:0,bottom:t.calc(t.margin).mul(-1).equal(),background:"transparent",pointerEvents:"auto"}}}},Wt.map(o=>qt(t,o)).reduce((o,n)=>Object.assign(Object.assign({},o),n),{}))},Qt=t=>{const{iconCls:s,componentCls:o,boxShadow:n,fontSizeLG:u,notificationMarginBottom:c,borderRadiusLG:m,colorSuccess:h,colorInfo:g,colorWarning:y,colorError:d,colorTextHeading:j,notificationBg:N,notificationPadding:C,notificationMarginEdge:v,notificationProgressBg:x,notificationProgressHeight:w,fontSize:a,lineHeight:i,width:l,notificationIconSize:p,colorText:f}=t,b=`${o}-notice`;return{position:"relative",marginBottom:c,marginInlineStart:"auto",background:N,borderRadius:m,boxShadow:n,[b]:{padding:C,width:l,maxWidth:`calc(100vw - ${ee(t.calc(v).mul(2).equal())})`,overflow:"hidden",lineHeight:i,wordWrap:"break-word"},[`${b}-message`]:{color:j,fontSize:u,lineHeight:t.lineHeightLG},[`${b}-description`]:{fontSize:a,color:f,marginTop:t.marginXS},[`${b}-closable ${b}-message`]:{paddingInlineEnd:t.paddingLG},[`${b}-with-icon ${b}-message`]:{marginInlineStart:t.calc(t.marginSM).add(p).equal(),fontSize:u},[`${b}-with-icon ${b}-description`]:{marginInlineStart:t.calc(t.marginSM).add(p).equal(),fontSize:a},[`${b}-icon`]:{position:"absolute",fontSize:p,lineHeight:1,[`&-success${s}`]:{color:h},[`&-info${s}`]:{color:g},[`&-warning${s}`]:{color:y},[`&-error${s}`]:{color:d}},[`${b}-close`]:Object.assign({position:"absolute",top:t.notificationPaddingVertical,insetInlineEnd:t.notificationPaddingHorizontal,color:t.colorIcon,outline:"none",width:t.notificationCloseButtonSize,height:t.notificationCloseButtonSize,borderRadius:t.borderRadiusSM,transition:`background-color ${t.motionDurationMid}, color ${t.motionDurationMid}`,display:"flex",alignItems:"center",justifyContent:"center",background:"none",border:"none","&:hover":{color:t.colorIconHover,backgroundColor:t.colorBgTextHover},"&:active":{backgroundColor:t.colorBgTextActive}},He(t)),[`${b}-progress`]:{position:"absolute",display:"block",appearance:"none",inlineSize:`calc(100% - ${ee(m)} * 2)`,left:{_skip_check_:!0,value:m},right:{_skip_check_:!0,value:m},bottom:0,blockSize:w,border:0,"&, &::-webkit-progress-bar":{borderRadius:m,backgroundColor:"rgba(0, 0, 0, 0.04)"},"&::-moz-progress-bar":{background:x},"&::-webkit-progress-value":{borderRadius:m,background:x}},[`${b}-actions`]:{float:"right",marginTop:t.marginSM}}},es=t=>{const{componentCls:s,notificationMarginBottom:o,notificationMarginEdge:n,motionDurationMid:u,motionEaseInOut:c}=t,m=`${s}-notice`,h=new X("antNotificationFadeOut",{"0%":{maxHeight:t.animationMaxHeight,marginBottom:o},"100%":{maxHeight:0,marginBottom:0,paddingTop:0,paddingBottom:0,opacity:0}});return[{[s]:Object.assign(Object.assign({},Te(t)),{position:"fixed",zIndex:t.zIndexPopup,marginRight:{value:n,_skip_check_:!0},[`${s}-hook-holder`]:{position:"relative"},[`${s}-fade-appear-prepare`]:{opacity:"0 !important"},[`${s}-fade-enter, ${s}-fade-appear`]:{animationDuration:t.motionDurationMid,animationTimingFunction:c,animationFillMode:"both",opacity:0,animationPlayState:"paused"},[`${s}-fade-leave`]:{animationTimingFunction:c,animationFillMode:"both",animationDuration:u,animationPlayState:"paused"},[`${s}-fade-enter${s}-fade-enter-active, ${s}-fade-appear${s}-fade-appear-active`]:{animationPlayState:"running"},[`${s}-fade-leave${s}-fade-leave-active`]:{animationName:h,animationPlayState:"running"},"&-rtl":{direction:"rtl",[`${m}-actions`]:{float:"left"}}})},{[s]:{[`${m}-wrapper`]:Object.assign({},Qt(t))}}]},ts=t=>({zIndexPopup:t.zIndexPopupBase+Ee+50,width:384}),ss=t=>{const s=t.paddingMD,o=t.paddingLG;return Be(t,{notificationBg:t.colorBgElevated,notificationPaddingVertical:s,notificationPaddingHorizontal:o,notificationIconSize:t.calc(t.fontSizeLG).mul(t.lineHeightLG).equal(),notificationCloseButtonSize:t.calc(t.controlHeightLG).mul(.55).equal(),notificationMarginBottom:t.margin,notificationPadding:`${ee(t.paddingMD)} ${ee(t.paddingContentHorizontalLG)}`,notificationMarginEdge:t.marginLG,animationMaxHeight:150,notificationStackLayer:3,notificationProgressHeight:2,notificationProgressBg:`linear-gradient(90deg, ${t.colorPrimaryBorderHover}, ${t.colorPrimary})`})},os=ze("Notification",t=>{const s=ss(t);return[es(s),Gt(s),Zt(s)]},ts);function Le(t,s){return s===null||s===!1?null:s||r.createElement(Ye,{className:`${t}-close-icon`})}const ns={success:We,info:Ge,error:Ve,warning:Ue},is=t=>{const{prefixCls:s,icon:o,type:n,message:u,description:c,actions:m,role:h="alert"}=t;let g=null;return o?g=r.createElement("span",{className:`${s}-icon`},o):n&&(g=r.createElement(ns[n]||null,{className:q(`${s}-icon`,`${s}-icon-${n}`)})),r.createElement("div",{className:q({[`${s}-with-icon`]:g}),role:h},g,r.createElement("div",{className:`${s}-message`},u),c&&r.createElement("div",{className:`${s}-description`},c),m&&r.createElement("div",{className:`${s}-actions`},m))};function as(t,s,o){let n;switch(t){case"top":n={left:"50%",transform:"translateX(-50%)",right:"auto",top:s,bottom:"auto"};break;case"topLeft":n={left:0,top:s,bottom:"auto"};break;case"topRight":n={right:0,top:s,bottom:"auto"};break;case"bottom":n={left:"50%",transform:"translateX(-50%)",right:"auto",top:"auto",bottom:o};break;case"bottomLeft":n={left:0,top:"auto",bottom:o};break;default:n={right:0,top:"auto",bottom:o};break}return n}function rs(t){return{motionName:`${t}-fade`}}function ls(t,s,o){return typeof t<"u"?t:o==null?void 0:o.closeIcon}var cs=function(t,s){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&s.indexOf(n)<0&&(o[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,n=Object.getOwnPropertySymbols(t);u<n.length;u++)s.indexOf(n[u])<0&&Object.prototype.propertyIsEnumerable.call(t,n[u])&&(o[n[u]]=t[n[u]]);return o};const xe=24,ds=4.5,ms="topRight",fs=({children:t,prefixCls:s})=>{const o=Ze(s),[n,u,c]=os(s,o);return n($.createElement(Qe,{classNames:{list:q(u,c,o)}},t))},us=(t,{prefixCls:s,key:o})=>$.createElement(fs,{prefixCls:s,key:o},t),xs=$.forwardRef((t,s)=>{const{top:o,bottom:n,prefixCls:u,getContainer:c,maxCount:m,rtl:h,onAllRemoved:g,stack:y,duration:d,pauseOnHover:j=!0,showProgress:N}=t,{getPrefixCls:C,getPopupContainer:v,notification:x,direction:w}=r.useContext(qe),[,a]=Je(),i=u||C("notification"),l=k=>as(k,o??xe,n??xe),p=()=>q({[`${i}-rtl`]:h??w==="rtl"}),f=()=>rs(i),[b,S]=Ke({prefixCls:i,style:l,className:p,motion:f,closable:!0,closeIcon:Le(i),duration:d??ds,getContainer:()=>(c==null?void 0:c())||(v==null?void 0:v())||document.body,maxCount:m,pauseOnHover:j,showProgress:N,onAllRemoved:g,renderNotifications:us,stack:y===!1?!1:{threshold:typeof y=="object"?y==null?void 0:y.threshold:void 0,offset:8,gap:a.margin}});return $.useImperativeHandle(s,()=>Object.assign(Object.assign({},b),{prefixCls:i,notification:x})),S});function ps(t){const s=$.useRef(null);return Xe(),[$.useMemo(()=>{const n=h=>{var g;if(!s.current)return;const{open:y,prefixCls:d,notification:j}=s.current,N=`${d}-notice`,{message:C,description:v,icon:x,type:w,btn:a,actions:i,className:l,style:p,role:f="alert",closeIcon:b,closable:S}=h,k=cs(h,["message","description","icon","type","btn","actions","className","style","role","closeIcon","closable"]),E=i??a,O=Le(N,ls(b,t,j));return y(Object.assign(Object.assign({placement:(g=void 0)!==null&&g!==void 0?g:ms},k),{content:$.createElement(is,{prefixCls:N,icon:x,type:w,message:C,description:v,actions:E,role:f}),className:q(w&&`${N}-${w}`,l,j==null?void 0:j.className),style:Object.assign(Object.assign({},j==null?void 0:j.style),p),closeIcon:O,closable:S??!!O}))},c={open:n,destroy:h=>{var g,y;h!==void 0?(g=s.current)===null||g===void 0||g.close(h):(y=s.current)===null||y===void 0||y.destroy()}};return["success","info","warning","error"].forEach(h=>{c[h]=g=>n(Object.assign(Object.assign({},g),{type:h}))}),c},[]),$.createElement(xs,Object.assign({key:"notification-holder"},t,{ref:s}))]}function gs(t){return ps(t)}function hs({isvisible:t,setVisible:s,id:o,firstAlarm:n}){var i;const u=()=>{s(!1),m([]),g(1),d(!1),N(!1)},[c,m]=r.useState([]),[h,g]=r.useState(1),[y,d]=r.useState(!1),[j,N]=r.useState(!1),[C,v]=r.useState(!1),x=r.useCallback(async(l=1,p=!1)=>{var f;p?v(!0):N(!0);try{const b=await et(o,{page:l,limit:50}),S=((f=b==null?void 0:b.data[0])==null?void 0:f.logs_before_resovle)||[];m(p?k=>[...k,...S]:S),d(S.length===50),p||g(1)}catch(b){console.log(b)}finally{N(!1),v(!1)}},[o]),w=()=>{const l=h+1;g(l),x(l,!0)};r.useEffect(()=>{o&&t&&x(1,!1)},[o,t,x]);const a=[...n?[{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ae(n.created_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:((i=Y(n))==null?void 0:i.title)||"Alarm Triggered"}),key:"first-alarm"}]:[],...c.map((l,p)=>{var f;return{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ae(l.created_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:(f=Y(l))==null?void 0:f.title}),key:`log-${p}`}}),...n!=null&&n.closed_at?[{title:e.jsx("span",{className:"text-[16px] font-medium text-primary/70",children:ae(n.closed_at)}),description:e.jsx("p",{className:"text-[18px] font-medium text-primary",children:"Alarm Resolved"}),key:"resolved"}]:[]];return e.jsx(tt,{open:t,onCancel:u,footer:null,centered:!0,className:"!w-[60vw] max-h-[90svh] bg-white !border-none overflow-x-hidden rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-[24px] font-semibold",children:"Alarm Logs"}),j?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(U,{size:"large"})}):e.jsxs(e.Fragment,{children:[e.jsx(Yt,{progressDot:!0,current:a.length,direction:"vertical",items:a,className:"max-h-[70vh] overflow-y-auto"}),C&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(U,{size:"small"})}),y&&!C&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(T,{type:"primary",onClick:w,className:"load-more-btn",children:"Load More"})}),c.length===0&&!n&&!j&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No logs found"})]})]})})}function vs({data:t={}}){var h,g,y,d,j,N,C;const{deviceData:s}=r.useContext(de),o=r.useContext(ve),{elderlyDetails:n}=o||{},u=(t==null?void 0:t.device_no)||(n==null?void 0:n.deviceId),c=r.useMemo(()=>{var v;return((v=s[u])==null?void 0:v.position)||[]},[(h=s[u])==null?void 0:h.position]),m=r.useMemo(()=>{const v=s[u],x=v==null?void 0:v.hbstaticsTimestamp,w=Date.now();return!(v!=null&&v.hbstatics)||!x||(w-x)/1e3>90?null:v.hbstatics},[s[u]]);return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"top-2 left-2 border-2 p-0 rounded-full flex items-center gap-1 pr-2 h-fit w-fit",children:[(c==null?void 0:c.length)>0?e.jsx(J,{color:"white",overlayInnerStyle:{color:"black",padding:"10px"},title:c==null?void 0:c.map((v,x)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{style:{backgroundColor:v==null?void 0:v.color},className:"p-2 rounded-full",children:e.jsx(re,{size:14,color:"white"})}),e.jsx("div",{children:e.jsx("p",{className:"text-[14px] m-0",children:v==null?void 0:v.posture})})]},x)),children:e.jsx("div",{className:"flex -space-x-4 cursor-pointer",children:c==null?void 0:c.map((v,x)=>e.jsx("div",{style:{backgroundColor:v==null?void 0:v.color},className:"p-1 rounded-full border-2 border-white",children:e.jsx(re,{size:16,color:"white"})},x))})}):e.jsx("div",{className:"bg-primary p-1 rounded-full border-2 border-white",children:e.jsx(re,{size:16,color:"white"})}),e.jsx("span",{className:"font-bold text-[14px]",children:c?c==null?void 0:c.length:0})]}),(t==null?void 0:t.room_type)==2&&m&&e.jsxs("div",{className:"top-2 left-2 border-2 p-0 rounded-full flex items-center gap-1 pr-2 h-fit w-fit px-2 py-1",children:[e.jsx("div",{className:"pr-1",children:e.jsx(st,{size:20,color:`${(d=(y=(g=te(m))==null?void 0:g.statusEvents)==null?void 0:y.sleepState)==null?void 0:d.color}`})}),e.jsx("span",{className:"font-semibold",children:((C=(N=(j=te(m))==null?void 0:j.statusEvents)==null?void 0:N.sleepState)==null?void 0:C.label)||"--"})]})]})}function bs({data:t={},elderlyId:s}){const[o,n]=r.useState(!1),[u,c]=r.useState(!1),[m,h]=r.useState(null),g=r.useCallback(()=>{c(!0),ot({room_id:t==null?void 0:t.device_no,elderly_id:s}).then(d=>{h(d.data)}).catch(d=>console.log(d)).finally(()=>{c(!1)})},[t==null?void 0:t.device_no,s]);r.useEffect(()=>{g()},[g]);function y(d){d&&ct(d)}return e.jsxs("div",{className:"flex flex-col gap-2 h-full mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-[20px] font-medium",children:t==null?void 0:t.name}),e.jsx(vs,{data:t})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(T,{icon:e.jsx(nt,{}),onClick:()=>y(t==null?void 0:t.device_no),children:[" ","Call"]}),e.jsxs(T,{icon:e.jsx(it,{}),onClick:()=>n(!0),children:[" ","Settings"]})]})]}),e.jsxs(U,{spinning:u,className:"relative",children:[(t==null?void 0:t.is_device_bind)==!1&&e.jsx("div",{className:"w-full h-full absolute bg-slate-400/20 top-0 z-10 backdrop-blur-sm flex items-center justify-center rounded-2xl",children:e.jsx(be,{size:40,color:"red"})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 h-full w-full border border-gray-200 rounded-2xl overflow-hidden relative z-1",children:[(t==null?void 0:t.mount_type)===2&&e.jsx(at,{roomInfo:m}),(t==null?void 0:t.mount_type)===1&&e.jsx(rt,{roomInfo:m})]})]}),e.jsx(lt,{isvisible:o,setVisible:n,elderly_id:s,device_id:t==null?void 0:t.device_no,room_id:t==null?void 0:t._id})]})}const js=r.forwardRef(({className:t,inset:s,children:o,...n},u)=>e.jsxs(je,{ref:u,className:P("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",t),...n,children:[o,e.jsx(dt,{className:"ml-auto"})]}));js.displayName=je.displayName;const ys=r.forwardRef(({className:t,...s},o)=>e.jsx(ye,{ref:o,className:P("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...s}));ys.displayName=ye.displayName;const Ns=r.forwardRef(({className:t,sideOffset:s=4,...o},n)=>e.jsx(mt,{children:e.jsx(Ne,{ref:n,sideOffset:s,className:P("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",t),...o})}));Ns.displayName=Ne.displayName;const ws=r.forwardRef(({className:t,inset:s,...o},n)=>e.jsx(we,{ref:n,className:P("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",s&&"pl-8",t),...o}));ws.displayName=we.displayName;const _s=r.forwardRef(({className:t,children:s,checked:o,...n},u)=>e.jsxs(_e,{ref:u,className:P("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:o,...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ce,{children:e.jsx(ft,{className:"h-4 w-4"})})}),s]}));_s.displayName=_e.displayName;const Cs=r.forwardRef(({className:t,children:s,...o},n)=>e.jsxs(Se,{ref:n,className:P("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Ce,{children:e.jsx(Vt,{className:"h-2 w-2 fill-current"})})}),s]}));Cs.displayName=Se.displayName;const Ss=r.forwardRef(({className:t,inset:s,...o},n)=>e.jsx(Ie,{ref:n,className:P("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...o}));Ss.displayName=Ie.displayName;const Is=r.forwardRef(({className:t,...s},o)=>e.jsx($e,{ref:o,className:P("-mx-1 my-1 h-px bg-muted",t),...s}));Is.displayName=$e.displayName;function $s({data:t={}}){var h,g,y,d;const[s,o]=r.useState(!1),[n,u]=r.useState(!1),c=(t==null?void 0:t.response_details)||((h=t==null?void 0:t.response_details)==null?void 0:h.length)>0&&(t==null?void 0:t.response_details[0])||null;function m(){o(!0)}return e.jsxs("div",{className:"p-4 border border-gray-200 rounded-md w-full",children:[e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("h2",{className:"text-[18px] font-semibold",children:(g=Y(t))==null?void 0:g.title}),e.jsx("div",{className:"size-2 bg-slate-400 rounded-xl"}),e.jsx("span",{className:"text-[13px] font-medium opacity-80",children:ut(t==null?void 0:t.created_at)})]}),e.jsxs("div",{children:[t!=null&&t.res_time?e.jsxs(xt,{color:"purple",className:"font-semibold",children:[pt((t==null?void 0:t.res_time)||0)," Resp. Time"]}):null,(t==null?void 0:t.event)==2&&e.jsx(J,{title:"Fall Playback",children:e.jsx(T,{shape:"circle",onClick:()=>m(),icon:e.jsx(Re,{})})})]})]}),e.jsx("div",{className:"bg-[#80CAA7]/5 mt-6 border border-[#0091DA] cursor-pointer hover:bg-[#0091DA]/10 rounded-sm",onClick:()=>u(!0),children:e.jsxs(Q,{separator:">",className:"text-[#0091DA] p-3",children:[e.jsx(Q.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",le(t==null?void 0:t.created_at)]})," ",(y=Y(t))==null?void 0:y.title]})}),c&&c!==null&&e.jsx(Q.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",le(c==null?void 0:c.created_at)]})," ",(d=Y(c))==null?void 0:d.title]})}),(t==null?void 0:t.closed_at)&&e.jsx(Q.Item,{children:e.jsxs("span",{className:"text-[#0091DA] text-[14px] font-normal",children:[e.jsxs("b",{children:[" ",le(t==null?void 0:t.closed_at)]})," Alarm Resolved"]})})]})})]}),e.jsx(gt,{isvisible:s,setVisible:o,data:t}),n&&e.jsx(hs,{isvisible:n,setVisible:u,id:t==null?void 0:t._id,firstAlarm:t})]})}function Rs({id:t}){const[s,o]=$.useState(!1),[n,u]=$.useState([]),[c,m]=$.useState(0),[h,g]=$.useState(1),y=5,{resolvedAlarm:d,setResolvedAlarm:j}=r.useContext(se),N=$.useCallback((x=1)=>{o(!0),ht({room_id:t,page:x,limit:y,to_date:B().format("YYYY-MM-DD")}).then(w=>{u(x===1?w.data||[]:a=>[...a,...w.data||[]]),m(w.total)}).catch(w=>{console.error(w)}).finally(()=>o(!1))},[t,d]);$.useEffect(()=>{t&&(g(1),N(1))},[t,N]);const C=()=>{const x=h+1;g(x),N(x)},v=n.length<c;return e.jsxs("div",{className:"bg-white",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("h3",{className:"text-base font-medium text-nowrap",children:"Todayâ€™s Alarm Logs"}),e.jsx("hr",{className:"w-full m-0"})]}),(n==null?void 0:n.length)===0&&!s?e.jsx(De,{description:"Alarm Logs Not Available For Today",className:"mt-4"}):e.jsxs("div",{className:"flex flex-col w-full gap-3",children:[n==null?void 0:n.map((x,w)=>e.jsx($s,{data:x},w)),s&&e.jsx("div",{className:"flex justify-center my-2",children:e.jsx(U,{})}),!s&&v&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx(T,{onClick:C,children:"Load More"})})]})]})}function Ds({elderlyId:t}){const[s,o]=r.useState([]),n=["Critical"],u=r.useCallback(async()=>{const m=[];let h=10;for(const g of n){if(h<=0)break;const y=bt(g);if(y)try{const j=(await vt({to_date:"2024-11-30",from_date:B().format("YYYY-MM-DD"),is_resolved:!1,elderly_id:t,limit:h,lookup:!1,...y})).data||[];if(m.push(...j),h-=j.length,h<=0)break}catch(d){console.error(`Error fetching ${g} alerts:`,d)}}o(m)},[t]);r.useEffect(()=>{t&&(u(),console.log(s))},[u,t]);const c={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,draggable:!0,centerMode:!1,variableWidth:!1,adaptiveHeight:!0,appendDots:m=>e.jsx("div",{style:{backgroundColor:"transparent",borderRadius:"10px",padding:"5px"},children:e.jsx("ul",{id:"dots",style:{margin:"0px"},children:m})})};return e.jsx(e.Fragment,{children:s.length>0&&e.jsx("div",{className:"mb-4",children:e.jsx(jt,{...c,className:"w-full transition-all duration-300",children:s==null?void 0:s.map((m,h)=>e.jsx(yt,{item:m,onResolved:()=>u()},h+1))})})})}const pe=t=>{if(!t)return"U";const s=t.trim().split(" ");return s.length>=2?(s[0][0]+s[s.length-1][0]).toUpperCase():t.substring(0,2).toUpperCase()},ks=({open:t,setOpen:s,data:o})=>{var g,y,d,j,N,C,v;const n=()=>s(!1),u=Nt(),[c,m]=r.useState(!1),h=x=>{const w=x.target.scrollTop;m(w>100)};return e.jsx(ke,{deviceId:((g=o==null?void 0:o.details)==null?void 0:g.length)>0?(y=o==null?void 0:o.details)==null?void 0:y.filter(x=>x.device_no).map(x=>x.device_no).join(","):"",children:e.jsx(Me,{title:c?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-white font-semibold text-sm shadow-sm",style:{color:"#000"},children:pe((o==null?void 0:o.name)||"User")}),e.jsx("div",{children:e.jsx("h3",{className:"font-semibold text-base text-white m-0",children:(o==null?void 0:o.name)||"Name not found"})})]}):null,onClose:n,closeIcon:e.jsx(Ae,{size:24,className:"text-white"}),size:"large",className:"relative",open:t,styles:{header:{background:"#514EB5",borderBottom:"none",transition:"all 0.3s ease"},body:{padding:0,overflow:"hidden"}},children:e.jsxs("div",{className:"h-full overflow-y-auto",onScroll:h,children:[e.jsxs("div",{className:"relative bg-[#514EB5] pb-6 pt-2 overflow-hidden",children:[e.jsx("style",{children:`
                @keyframes wave1 {
                  0% { transform: translateX(0) translateY(0) rotate(0deg); }
                  50% { transform: translateX(30px) translateY(-20px) rotate(10deg); }
                  100% { transform: translateX(0) translateY(0) rotate(0deg); }
                }
                @keyframes wave2 {
                  0% { transform: translateX(0) translateY(0) rotate(0deg); }
                  50% { transform: translateX(-25px) translateY(15px) rotate(-8deg); }
                  100% { transform: translateX(0) translateY(0) rotate(0deg); }
                }
                @keyframes wave3 {
                  0% { transform: scale(1) rotate(0deg); }
                  50% { transform: scale(1.1) rotate(5deg); }
                  100% { transform: scale(1) rotate(0deg); }
                }
                .animate-wave1 {
                  animation: wave1 12s ease-in-out infinite;
                }
                .animate-wave2 {
                  animation: wave2 15s ease-in-out infinite;
                }
                .animate-wave3 {
                  animation: wave3 10s ease-in-out infinite;
                }
              `}),e.jsx("svg",{className:"absolute top-0 right-0 w-64 h-64 opacity-5 animate-wave1",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fill:"#ffffff",d:"M44.7,-76.4C58.8,-69.2,71.8,-59.1,79.6,-45.8C87.4,-32.6,90,-16.3,88.5,-0.9C87,14.6,81.4,29.2,73.1,42.8C64.8,56.4,53.8,69,39.9,76.4C26,83.8,9.2,86,-7.3,86.2C-23.8,86.4,-47.6,84.6,-63.7,75.4C-79.8,66.2,-88.2,49.6,-91.4,32.4C-94.6,15.2,-92.6,-2.6,-86.8,-18.4C-81,-34.2,-71.4,-48,-58.9,-56.8C-46.4,-65.6,-31,-69.4,-16.3,-73.8C-1.6,-78.2,12.4,-83.2,26.7,-83.6C41,-84,55.6,-79.8,44.7,-76.4Z",transform:"translate(100 100)"})}),e.jsx("svg",{className:"absolute bottom-0 left-0 w-56 h-56 opacity-5 animate-wave2",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fill:"#ffffff",d:"M39.5,-65.5C51.4,-58.1,61.3,-47.3,68.4,-34.8C75.5,-22.3,79.8,-8.1,79.3,6.1C78.8,20.3,73.5,34.5,64.8,46.3C56.1,58.1,44,67.5,30.4,72.8C16.8,78.1,1.7,79.3,-13.3,77.8C-28.3,76.3,-43.2,72.1,-55.8,64.2C-68.4,56.3,-78.7,44.7,-83.8,31.2C-88.9,17.7,-88.8,2.3,-84.9,-11.8C-81,-25.9,-73.3,-38.7,-62.5,-47.3C-51.7,-55.9,-38.8,-60.3,-26.1,-67.3C-13.4,-74.3,-0.9,-83.9,11.3,-82.1C23.5,-80.3,27.6,-72.9,39.5,-65.5Z",transform:"translate(100 100)"})}),e.jsx("svg",{className:"absolute top-1/2 right-1/4 w-48 h-48 opacity-5 animate-wave3",viewBox:"0 0 200 200",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{fill:"#ffffff",d:"M41.3,-71.8C53.1,-63.9,62.3,-52.2,68.9,-39.2C75.5,-26.2,79.5,-11.9,79.8,2.6C80.1,17.1,76.7,31.8,69.4,44.3C62.1,56.8,50.9,67.1,37.8,73.8C24.7,80.5,9.7,83.6,-5.1,82.9C-19.9,82.2,-34.6,77.7,-47.4,70.2C-60.2,62.7,-71.1,52.2,-77.8,39.2C-84.5,26.2,-87,10.7,-85.3,-4.3C-83.6,-19.3,-77.7,-33.8,-68.9,-45.8C-60.1,-57.8,-48.4,-67.3,-35.4,-74.8C-22.4,-82.3,-8.1,-87.8,4.9,-86.4C17.9,-85,29.5,-79.7,41.3,-71.8Z",transform:"translate(100 100)"})}),e.jsx("div",{className:"relative z-10 px-6",children:e.jsx("div",{onClick:()=>{window.scrollTo(0,0),u(`/supporter/elderlies/elderly-profile/${o.id}?tab=overview`)},className:"group cursor-pointer bg-white hover:bg-gray-50 rounded-lg p-5 transition-all duration-300 shadow-lg hover:shadow-xl",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative flex-shrink-0",children:e.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center bg-white font-bold text-xl shadow-lg group-hover:scale-105 transition-transform duration-300 border-2",style:{color:"#514EB5",borderColor:"#514EB5"},children:pe((o==null?void 0:o.name)||"User")})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 transition-colors duration-200 truncate",children:(o==null?void 0:o.name)||"Name not found"}),e.jsx("div",{className:"flex items-center gap-2 mt-1.5",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-50 text-purple-700 border border-purple-200",children:["Room No: ",(o==null?void 0:o.room)||"Not Found"]})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2 flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[#514EB5] font-medium",children:"Tap to view details"}),e.jsx(fe,{className:"text-[#514EB5] group-hover:translate-x-1 transition-transform duration-200"})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#514EB5] group-hover:bg-[#6159c4] flex items-center justify-center shadow-md group-hover:shadow-lg transition-all duration-300",children:e.jsx(fe,{className:"text-white text-2xl group-hover:translate-x-1 transition-transform duration-200"})})})]})})})]}),e.jsxs("div",{className:"bg-gray-50 min-h-screen px-6 pt-6",children:[e.jsx(Ds,{elderlyId:o==null?void 0:o.id}),e.jsxs("div",{className:"mb-8 mt-12",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("h3",{className:"text-base font-medium text-nowrap",children:"Room Map"}),e.jsx("hr",{className:"w-full m-0"})]}),(d=o==null?void 0:o.details)==null?void 0:d.filter(x=>x==null?void 0:x.device_no).map((x,w)=>e.jsx(bs,{data:x,elderlyId:o==null?void 0:o.id},w)),((N=(j=o==null?void 0:o.details)==null?void 0:j.filter(x=>x==null?void 0:x.device_no))==null?void 0:N.length)==0&&e.jsx(De,{description:"No Room",className:"mt-4"})]}),e.jsx("div",{className:"mb-8 mt-8",children:e.jsx(Rs,{id:(v=(C=o==null?void 0:o.details)==null?void 0:C.filter(x=>(x==null?void 0:x.room_type)==2)[0])==null?void 0:v._id})})]})]})})})},Ms=$.memo(ks);function As({setOpen:t,open:s,room_id:o}){const[n,u]=r.useState([]),[c,m]=r.useState(1),[h,g]=r.useState(!1),[y,d]=r.useState(!1),[j,N]=r.useState(0),[C,v]=r.useState(""),[x,w]=r.useState(null);function a(){t(!1)}const i=r.useCallback((f=1,b=!1)=>{g(!0),wt({limit:30,page:f,room_no:o,to_date:x?x.format("YYYY-MM-DD"):B().format("YYYY-MM-DD"),sort_by:j}).then(S=>{u(k=>b?[...k,...S.data]:S.data),S.total_pages&&f<S.total_pages?d(!0):d(!1)}).catch(console.error).finally(()=>g(!1))},[j,C,x]);r.useEffect(()=>{m(1),i(1,!1)},[i]);const l=()=>{const f=c+1;m(f),i(f,!0)},p=[{title:e.jsx("span",{className:"px-0 block font-medium text-gray-700",children:"Check-In"}),dataIndex:"time_of_visit",key:"time_of_visit",render:f=>e.jsx("div",{className:"px-2",children:e.jsx("div",{className:"rounded-[6px] text-nowrap bg-white border border-[#E4E4E7] px-3 py-1 text-[12px] font-medium text-gray-700 inline-block",children:B(f).format("HH:mm:ss")})})},{title:e.jsx("span",{className:"px-0 block  font-medium text-gray-700",children:"Check-Out"}),dataIndex:"exit_time",key:"exit_time",render:f=>e.jsx("div",{className:"px-2 ",children:f&&B(f).format("HH:mm:ss")||"-"})},{title:e.jsx("span",{className:"px-0 block  font-medium text-gray-700",children:"Stay"}),key:"duration",render:f=>e.jsx("div",{className:"px-2 text-nowrap",children:Rt(f==null?void 0:f.time_of_visit,f==null?void 0:f.exit_time)})},{title:e.jsx("span",{className:"px-0 block text-nowrap font-medium text-gray-700",children:"Occupancy"}),key:"event_user_no",render:f=>e.jsx("div",{className:"px-2",children:f==null?void 0:f.event_user_no})}];return e.jsx(Me,{title:null,onClose:a,closeIcon:e.jsx(Ae,{size:24}),size:"large",open:!0,children:e.jsxs("div",{className:" bg-white rounded-[12px] w-full",children:[e.jsxs("h2",{className:"text-[22px] font-semibold mb-4",children:["Visit Logs - ",e.jsxs("small",{className:"text-slate-500",children:[" Room ",o]})]}),e.jsx(_t,{theme:{token:{colorPrimary:"#64748b"}},children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Ct,{onChange:f=>w(f),placeholder:"Today's Visits"}),e.jsxs("div",{className:"flex items-center px-3 py-1 border rounded cursor-pointer",onClick:()=>N(f=>f===1?0:1),children:[j===1?"Oldest First":"Latest First",j===1?e.jsx(St,{}):e.jsx(It,{})]})]})}),e.jsx("div",{style:{maxHeight:"auto",overflowY:"auto"},children:e.jsx("div",{className:"w-full ",children:e.jsx($t,{columns:p,dataSource:n,pagination:!1,loading:h&&c===1,size:"middle",rowClassName:(f,b)=>b===0?"bg-white":(b-1)%2===0?"bg-gray-50":"bg-white",className:`
      [&_.ant-table-thead>tr>th]:!bg-gray-100
      [&_.ant-table-thead>tr>th]:!py-3
      [&_.ant-table-thead>tr>th]:!text-gray-700
      [&_.ant-table-thead>tr>th]:!font-semibold
      [&_.ant-table-tbody_td]:!border-none
      [&_.ant-table-tbody_td]:!whitespace-normal
    `})})}),y&&!h&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(T,{onClick:l,type:"default",children:"Load More"})}),y&&h&&e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(U,{})})]})})}function ge({deviceCode:t="",selectedEvents:s=[],group:o="all",rooms:n=[],deviceOnline:u,visit_count:c}){var v,x,w,a;const{deviceData:m}=r.useContext(de),h=r.useMemo(()=>({0:null,1:At,2:Mt,3:kt,4:Dt,5:Re,6:W,9:W,10:W,11:W,7:ue,8:ue}),[]),g=r.useMemo(()=>({2:1,1:2,3:3,4:4}),[]),y=i=>i.room_type===2?"Bedroom":i.name&&i.name.trim()!==""?i.name:{1:"Living Room",2:"Bedroom",3:"Bathroom",4:"Other Room"}[i.room_type]||"Unknown Room",d=r.useMemo(()=>{if(!n||n.length===0)return null;const i=[...n].sort((l,p)=>{const f=g[l.room_type]||999,b=g[p.room_type]||999;return f-b});for(const l of i){if(!l.device_no)continue;const p=m[l.device_no],f=(p==null?void 0:p.position)||[];if(f.length>0)return{room:l,deviceData:p,positionData:f,deviceCode:l.device_no}}return null},[n,m,g]),j=r.useMemo(()=>{var f,b;if(!d)return null;const i=d.deviceData,l=i==null?void 0:i.hbstaticsTimestamp;return!(i!=null&&i.hbstatics)||!l||(Date.now()-l)/1e3>90?null:(b=(f=te(i.hbstatics))==null?void 0:f.statusEvents)==null?void 0:b.sleepState},[d]),N=r.useMemo(()=>{if(!d)return[];const{positionData:i}=d;return!s||s.length===0?i:i.filter(l=>s.includes(l.posture))},[d,s]);if(!d)return e.jsxs("div",{className:"w-full flex flex-col justify-center items-center",children:[e.jsx("div",{className:"text-[#6B7280] w-fit p-[16px] bg-[#F3F4F6] rounded-full",style:{backgroundColor:(v=n[0])!=null&&v.is_device_bind?"#F3F4F6":"#FCA5A520"},children:e.jsx(J,{title:(x=n[0])!=null&&x.is_device_bind?"Out of Room":" Device Offline",children:(w=n[0])!=null&&w.is_device_bind?e.jsx(Lt,{size:20}):e.jsx(be,{size:20,color:"red"})})}),e.jsx("div",{className:"flex flex-col w-full items-center justify-center mt-[10px]",children:e.jsx("div",{className:"text-[14px] font-medium text-primary/85",children:(a=n[0])!=null&&a.is_device_bind?"Out of Room":" Device Offline"})})]});const C=()=>{const{room:i}=d,l=N[0];return i.room_type===2?l.postureIndex===6&&j?j.label:l.posture:`In ${y(i)}`};return e.jsxs("div",{className:"w-full flex flex-col justify-center items-center",children:[e.jsx("div",{children:e.jsx(J,{color:"white",className:"flex -space-x-3 cursor-pointer",overlayInnerStyle:{color:"black",padding:"10px"},title:N.map((i,l)=>{let p=i==null?void 0:i.posture;const{room:f}=d;let b=!1,S=null;return f.room_type===2&&i.postureIndex===6&&j?(p=j.label,b=!0,S=j.color2):f.room_type!==2&&(p=`In ${y(f)}`),e.jsxs("div",{className:"flex items-center gap-2 w-fit",style:{marginBottom:l===N.length-1?"0":"8px"},children:[e.jsx("div",{style:{backgroundColor:b?S:i==null?void 0:i.color2},className:"p-2 rounded-full",children:e.jsx(Ot,{size:14,color:"white"})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm m-0",children:p})})]},l)}),children:N.map((i,l)=>{let p=h[i.postureIndex],f=!1,b=null;const{room:S}=d;return S.room_type===2&&i.postureIndex===6&&j&&(f=!0,b=j.color2),e.jsx("div",{style:{backgroundColor:f?`${b}30`:`${i==null?void 0:i.color2}30`},className:"rounded-full p-[15px] flex items-center justify-center border-2 border-white",children:f?e.jsx(W,{size:20,color:b}):p&&e.jsx(p,{size:20,color:i==null?void 0:i.color2})},l)})})}),N.length>0&&e.jsx("div",{className:"flex flex-col w-full items-center justify-center mt-[10px]",children:e.jsx("div",{className:"text-[14px] text-[#4B5563] font-medium",children:C()})})]})}function he({deviceCode:t,visit_count:s=0,onClick:o}){const{visitCountMap:n,setInitialCount:u}=r.useContext(se);return r.useEffect(()=>{u(t,s)},[t,s]),e.jsxs("div",{onClick:o,className:"text-[12px] text-[#6B7280] font-medium cursor-pointer hover:text-slate-800",children:[n[t]||0," Visits"]})}const Ls=({name:t,room:s,deviceCode:o,selectedEvents:n,sleepScore:u,emergencyContacts:c=[],rooms:m=[],isDanger:h=!0,currentAlertDetails:g,priority:y=0,user:d})=>{const[j,N]=r.useState(!1),[C,v]=r.useState(!1),[x,w]=$.useState(null),a=m==null?void 0:m.some(i=>i==null?void 0:i.is_device_bind);return e.jsxs(e.Fragment,{children:[y==1?e.jsx("div",{className:"relative rounded-[10px] min-w-[220px] max-w-[220px] w-full flex-grow h-fit cursor-pointer border-2 p0 card_UI",onClick:()=>N(!0),style:{borderColor:"#FCA5A5"},children:e.jsx("div",{className:"bg-white/90 rounded-[7px] border border-gray-200 p-[10px] flex flex-col gap-4 h-full ",children:e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsxs("div",{className:"text-[13px] font-medium font-roboto text-gray-500 leading-none w-full justify-center flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full",style:{backgroundColor:a?"green":"red"}}),"Room ",s]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-[10px] w-full",children:t}),e.jsxs("div",{className:"mt-[5px] flex flex-col items-center",children:[e.jsx(ge,{deviceCode:o,rooms:m,visit_count:d==null?void 0:d.visit_count,deviceOnline:a}),e.jsx(he,{onClick:i=>{var l;i.stopPropagation(),v(!0),w((l=m[0])==null?void 0:l.room_no)},deviceCode:o,visit_count:d==null?void 0:d.visit_count})]})]})})}):e.jsx("div",{className:"relative bg-white rounded-[10px]  cursor-pointer border-2 border-[#8BD1A5] p-[10px] min-w-[220px] max-w-[220px] card_UI w-fit flex-grow flex flex-col h-fit",onClick:()=>N(!0),style:{borderColor:a?"#8BD1A5":"#00000010"},children:e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsxs("div",{className:"text-[13px] font-semibold text-[#6B7280] leading-none w-full flex justify-center items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full",style:{backgroundColor:a?"green":"red"}}),"Room ",s]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-[10px] w-full",children:t}),e.jsxs("div",{className:"mt-[5px] flex flex-col items-center",children:[e.jsx(ge,{deviceCode:o,rooms:m,visit_count:d==null?void 0:d.visit_count}),e.jsx(he,{onClick:i=>{var l;i.stopPropagation(),v(!0),w((l=m[0])==null?void 0:l.room_no)},deviceCode:o,visit_count:d==null?void 0:d.visit_count})]})]})}),C&&e.jsx(As,{open:C,setOpen:v,room_id:x}),j&&e.jsx(Ms,{open:j,setOpen:N,data:d})]})},ce=$.memo(Ls),Os=({users:t,selectedEvents:s,notVisitedRoom:o,isActiveAlertsSelect:n,loading:u})=>{const{deviceData:c}=r.useContext(de),[m,h]=r.useState([]),g="criticalAlarmCountsCache";r.useEffect(()=>{var i;const a=localStorage.getItem(g);if(a){const l=JSON.parse(a);Date.now()-l.timestamp<24*60*60*1e3&&h(l.data)}Ft({to_date:B().subtract(14,"day").format("YYYY-MM-DD"),from_date:(i=B())==null?void 0:i.format("YYYY-MM-DD"),limit:1e3}).then(l=>{const p=(l==null?void 0:l.data)||[];h(p),localStorage.setItem(g,JSON.stringify({data:p,timestamp:Date.now()}))}).catch(l=>{console.log(l)})},[]);const y=r.useMemo(()=>{const a={};for(const i of m){a[i.room_id]||(a[i.room_id]={});const l=i.event;a[i.room_id][l]=(a[i.room_id][l]||0)+i.count}return a},[m]),d={2:3},j=a=>{const i=y[a];return i?Object.entries(d).some(([l,p])=>(i[l]||0)>=p):!1},N=a=>!a.rooms||a.rooms.length===0?!1:a.rooms.some(i=>{if(!i.device_no)return!1;const l=c[i.device_no];return(l==null?void 0:l.position)&&l.position.length>0}),C=r.useMemo(()=>!s||s.length===0?t:s.includes("outOfRoom")?t.filter(a=>a.is_device_bind!==!1&&!N(a)):t.filter(a=>{var k,E,O;if(!N(a))return!1;const i={2:1,1:2,3:3,4:4,5:5},l=[...a.rooms||[]].sort((A,D)=>{const K=i[A.room_type]||999,V=i[D.room_type]||999;return K-V});let p=null;for(const A of l){if(!A.device_no)continue;const D=c[A.device_no];if(D!=null&&D.position&&D.position.length>0){p={room:A,deviceData:D};break}}if(!p)return!1;const f=p.deviceData.position||[];if(f.length===0)return!1;const b=p.deviceData;let S=null;return b!=null&&b.hbstatics&&(b!=null&&b.hbstaticsTimestamp)&&(Date.now()-b.hbstaticsTimestamp)/1e3<=90&&(S=((O=(E=(k=te(b.hbstatics))==null?void 0:k.statusEvents)==null?void 0:E.sleepState)==null?void 0:O.label)||null),f.every(A=>{const D=f[0];if(!D)return!1;if(D.postureIndex===6){if(s.some(V=>["awake","asleep"].includes(V))){if(!S)return!1;if(s.includes("awake"))return S==="Awake";if(s.includes("asleep"))return["Light Sleep","Deep Sleep"].includes(S)}return s.includes(6)}return s.includes(D.postureIndex)})}),[c,s,t,n,o]),[v,x,w]=r.useMemo(()=>{const a=[],i=[],l=[];return C.forEach(p=>{if(p.is_device_bind===!1){l.push(p);return}const f=p.room_id;j(f)?a.push(p):i.push(p)}),o?[a.filter(p=>!p.visit_count||p.visit_count==0),i.filter(p=>!p.visit_count||p.visit_count==0),l.filter(p=>!p.visit_count||p.visit_count==0)]:[a,i,l]},[C,y,n,o]);return e.jsxs("div",{className:"flex flex-col gap-6",children:[u&&(t==null?void 0:t.length)==0&&e.jsx("div",{className:"flex gap-2 flex-wrap",children:Array.from({length:8}).map((a,i)=>e.jsx(Fs,{},i))}),v.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsxs("h2",{className:"text-sm text-primary/90 text-nowrap flex items-center",children:["High Risk Residents"," ",e.jsx(J,{className:"ml-2",title:"A room is marked as high risk if a resident has fallen 3 or more times in the last 2 weeks.",children:e.jsx(Pt,{className:"text-sm text-primary cursor-pointer"})})]}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map((a,i)=>e.jsx(ce,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsx("h2",{className:"text-sm text-primary/90 text-nowrap",children:"All Residents"}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:x.map((a,i)=>e.jsx(ce,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]}),w.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"w-full flex items-center justify-center gap-3 mb-4",children:[e.jsx("h2",{className:"text-sm text-primary/90 text-nowrap",children:"Offline Rooms"}),e.jsx("hr",{className:"w-full"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(a=>e.jsx(ce,{name:a.name,room:a.room,sleepScore:a.sleepScore,deviceCode:a.deviceCode,selectedEvents:s,currentAlertDetails:a==null?void 0:a.currentAlertDetails,emergencyContacts:a.emergency_contacts,rooms:a.rooms,priority:a.priority,user:a},a.id))})]})]})},Fs=()=>e.jsx("div",{className:"relative rounded-[9px] min-w-[220px] max-w-[280px] w-fit flex-grow h-fit cursor-pointer border-2",children:e.jsxs("div",{className:"bg-white/90 rounded-[7px]  p-[10px] flex flex-col gap-4 h-full relative",children:[e.jsx("div",{className:"bg-[linear-gradient(to_bottom,_#fef2f2_20%,_#ffffff_80%)] absolute inset-[1px] rounded-[6px] -z-10"}),e.jsxs("div",{className:"flex flex-col justify-between items-center w-full",children:[e.jsxs("div",{className:"text-[14px] font-semibold text-gray-500 leading-none w-full flex items-center gap-2",children:[e.jsx("div",{className:"size-3 rounded-full bg-gray-300"}),e.jsx(Z.Input,{active:!0,size:"small",style:{width:80}})]}),e.jsx("div",{className:"text-[16px] font-medium text-primary text-center mt-1 w-full",children:e.jsx(Z.Input,{active:!0,size:"small",style:{width:100}})}),e.jsx("div",{className:"mt-4 mb-1",children:e.jsx(Z.Button,{active:!0,size:"small",style:{width:120}})})]}),e.jsx("div",{className:"flex justify-between z-10 absolute top-2 right-2",children:e.jsx(Z.Avatar,{active:!0,size:"small",shape:"circle"})})]})}),Ps=(t,s=24*60*60*1e3)=>{const o=localStorage.getItem(t);if(!o)return null;const n=JSON.parse(o);return Date.now()-n.timestamp<s?n.data:null},zs=(t,s)=>{localStorage.setItem(t,JSON.stringify({data:s,timestamp:Date.now()}))};function Ys(){const[t,s]=r.useState(""),[o,n]=r.useState(""),[u,c]=r.useState([]),[m,h]=r.useState(!1),[g,y]=r.useState(1),d=30,{totalResident:j,setTotalResident:N,setActiveAlerts:C,activeAlerts:v,selectedEvents:x,setSelectedEvents:w,setNotVisitedRoom:a,notVisitedRoom:i,notVisitRoomCount:l,setNotVisitRoomCount:p,offlineRoomCount:f,setOfflineRoomCount:b}=r.useContext(se),{resolvedAlarm:S,setResolvedAlarm:k}=r.useContext(se),{notificationEvent:E}=gs(),O="roomListCache",A="allUIDsCache",D=r.useCallback(async(F=1,z=!1)=>{var oe,G;try{if(F===1&&!z){const _=localStorage.getItem(O);if(_){const I=JSON.parse(_);Date.now()-I.timestamp<24*60*60*1e3&&(c(I.data),N(I.totalResident||0),p(I.notVisitRoomCount||0))}}h(!0);const R=await zt({page:F,limit:d});N((R==null?void 0:R.total)||0);const ne=_=>{const I=[2,1,3,4];for(const L of I){const M=_.find(H=>(H==null?void 0:H.room_type)===L&&(H==null?void 0:H.device_no));if(M)return M}return _.find(L=>L==null?void 0:L.device_no)||""},ie=R.data.map(_=>{var L;const I=ne(_.rooms);return{id:_._id,name:_.name||"N/A",room:_.room_no||"N/A",visit_count:_.visit_count||0,room_id:I==null?void 0:I._id,is_device_bind:(I==null?void 0:I.is_device_bind)||!1,sleepScore:Math.floor(Math.random()*100),emergency_contacts:_.emergency_contacts||[],deviceCode:I==null?void 0:I.device_no,rooms:(_.rooms||[]).filter(M=>M.device_no&&M.device_no.trim()!=="").map(M=>({room:M.name||"N/A",device_no:M.device_no,room_no:_.room_no,room_type:M.room_type,id:M._id,is_device_bind:M.is_device_bind})),currentAlertDetails:{...Y(_==null?void 0:_.alarms_data[0]),created_at:(L=_==null?void 0:_.alarms_data[0])==null?void 0:L.created_at},priority:_==null?void 0:_.highest_priority,details:_==null?void 0:_.rooms}});c(_=>z?[..._,...ie]:ie);const Oe=R.data.map(_=>{const I=ne(_.rooms);return(I==null?void 0:I.device_no)||null}).filter(Boolean),Fe=(oe=R.data.filter(_=>{const I=ne(_.rooms);return(I==null?void 0:I.is_device_bind)===!1}))==null?void 0:oe.length;b(Fe);const me=(G=R.data.filter(_=>!_.visit_count||_.visit_count==0))==null?void 0:G.length;p(me||0),n(Oe.join(",")),localStorage.setItem(O,JSON.stringify({data:ie,timestamp:Date.now(),totalResident:(R==null?void 0:R.total)||0,notVisitRoomCount:me||0}))}catch(R){console.log(R)}finally{h(!1)}},[S,E]),K=r.useCallback(async()=>{var F;try{const z=Ps(A);z&&s(z);const G=(F=(await Bt()).data)==null?void 0:F.map(R=>R==null?void 0:R.uid).filter(Boolean).join(",");s(G),zs(A,G)}catch(z){console.log(z)}},[]);r.useEffect(()=>{D(1),K()},[D]);const V=()=>{if(u.length<j){const F=g+1;y(F),D(F,!0)}};return console.log("device list========>",o,"2========>",t),e.jsx(ke,{deviceId:[t].filter(Boolean).join(","),children:e.jsx(ve.Provider,{value:{selectedEvents:x,setSelectedEvents:w,setActiveAlerts:C,activeAlerts:v,totalResident:j,setNotVisitedRoom:a,notVisitedRoom:i,notVisitRoomCount:l},children:e.jsxs("div",{className:"w-full bg-[#F4F4F4] h-[calc(100svh-100px)] flex flex-col items-start font-poppins relative ",children:[e.jsxs("div",{className:"p-[20px] w-full flex lg:flex-nowrap flex-wrap gap-2 lg:gap-8 sticky top-0 bg-gradient-to-b from-[#F4F4F4] via-[#F4F4F4]/70 to-[#F4F4F4]/10 z-50",children:[e.jsx("div",{className:"lg:w-[60%] w-[100%]",children:e.jsx(Tt,{})}),e.jsx("div",{className:"lg:w-[40%] w-[100%]",children:e.jsx(Et,{})})]}),e.jsx("div",{className:"w-full p-5 pt-1 h-[calc(100svh-100px)] overflow-auto",children:e.jsx(Os,{users:u,selectedEvents:x,loading:m&&u.length===0,isActiveAlertsSelect:v,notVisitedRoom:i})}),u.length<j&&e.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2",children:e.jsx(T,{shape:"round",onClick:V,disabled:m,className:"shadow-lg",children:m?e.jsx(U,{size:"small"}):e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Load More ",e.jsx(Ht,{size:12})]})})})]})})})}export{Ys as default};
