import{j as e,E as I,hy as le,aa as ne,r as T,hz as ie,i as p,hA as ce,hB as de,hC as me,hD as fe,hE as he,hF as xe,cc as ue,hG as pe,hH as ge,hI as ve,hb as ye,hJ as be,hK as De,hL as we,hM as je,hN as Se,hO as Ye,hP as Me,hQ as Ae,hm as B,hd as Ne}from"./index-CR4fhODd.js";function Le({width:h="100%",height:M=400,data:j=[]}){const s=()=>{if(!j||j.length===0)return d();const a=new Map;j.forEach(l=>{const v=new Date(l.year,l.month-1,l.day),F=v.toISOString().split("T")[0],N=l.event==="5"?"Device Offline":"Fall Alert";a.has(F)||a.set(F,{date:v,timestamp:v.getTime(),dateFormatted:A(v,j),tooltipDate:g(v),"Fall Alert":0,"Device Offline":0});const H=a.get(F);H[N]+=l.count||0});const n=Array.from(a.values()).sort((l,v)=>l.timestamp-v.timestamp),S=n.map(l=>l.dateFormatted),Y=n.map(l=>l.tooltipDate),r=n.map(l=>l["Fall Alert"]),D=n.map(l=>l["Device Offline"]);return{dates:S,tooltipDates:Y,fallAlertData:r,deviceOfflineData:D}},A=(a,n)=>{if(!n||n.length===0)return a.toLocaleDateString("en-US",{month:"short",day:"numeric"});const S=n.map(v=>new Date(v.year,v.month-1,v.day)),Y=new Date(Math.min(...S)),r=new Date(Math.max(...S)),D=Math.abs(r-Y);return Math.ceil(D/(1e3*60*60*24))<=60?a.toLocaleDateString("en-US",{month:"short",day:"numeric"}):a.toLocaleDateString("en-US",{month:"short",year:"2-digit"})},g=a=>a.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),d=()=>{const a=[],n=[],S=[],Y=[],r=new Date;for(let D=9;D>=0;D--){const l=new Date(r);l.setDate(r.getDate()-D),a.push(l.toLocaleDateString("en-US",{month:"short",day:"numeric"})),n.push(l.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})),S.push(Math.floor(0)),Y.push(Math.floor(0))}return{dates:a,tooltipDates:n,fallAlertData:S,deviceOfflineData:Y}},{dates:t,tooltipDates:x,fallAlertData:u,deviceOfflineData:E}=s(),O=a=>a<=10?0:a<=20?1:a<=40?2:a<=60?3:Math.floor(a/12),W=u.reduce((a,n)=>a+n,0),k=E.reduce((a,n)=>a+n,0),b={tooltip:{trigger:"axis",backgroundColor:"transparent",borderWidth:0,className:"!shadow-none",axisPointer:{type:"line",lineStyle:{color:"rgb(var(--ms-text-color)/0.2)",width:1}},formatter:a=>{const n=a[0].dataIndex,S=x[n],Y=a.find(D=>D.seriesName==="Fall Alert"),r=a.find(D=>D.seriesName==="Device Offline");return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[180px]">
            <div class="text-sm font-semibold text-text mb-3 border-b border-border pb-2">
              ${S}
            </div>
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #ef4444"></div>
                  <span class="text-text/80 text-sm">Fall Alert</span>
                </div>
                <span class="font-mono font-medium text-text">${(Y==null?void 0:Y.value)||0}</span>
              </div>
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full" style="background-color: #f59e0b"></div>
                  <span class="text-text/80 text-sm">Device Offline</span>
                </div>
                <span class="font-mono font-medium text-text">${(r==null?void 0:r.value)||0}</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!0,bottom:10,left:"center",itemWidth:12,itemHeight:12,itemGap:20,textStyle:{color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"normal"},formatter:function(a){return a==="Fall Alert"?`Fall Alert: ${W.toLocaleString()}`:a==="Device Offline"?`Device Offline: ${k.toLocaleString()}`:a}},grid:{left:"3%",right:"4%",bottom:t.length>15?"80px":"50px",top:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t,axisLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.2)"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:11,interval:O(t.length),rotate:t.length>15?45:0,margin:t.length>15?15:8,formatter:a=>a},axisTick:{alignWithLabel:!0,interval:O(t.length)}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12}},series:[{name:"Fall Alert",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#ef4444"},itemStyle:{color:"#ef4444"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(239, 68, 68, 0.3)"},{offset:1,color:"rgba(239, 68, 68, 0.05)"}]}},data:u},{name:"Device Offline",type:"line",smooth:!0,showSymbol:!1,lineStyle:{width:3,color:"#f59e0b"},itemStyle:{color:"#f59e0b"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(245, 158, 11, 0.3)"},{offset:1,color:"rgba(245, 158, 11, 0.05)"}]}},data:E}],dataZoom:[{type:"inside",start:t.length>30?100-Math.floor(3e3/t.length):0,end:100},{show:!1}]};return e.jsx("div",{style:{width:h,height:M},children:e.jsx(I,{option:b,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Te({data:h=[],width:M="100%",height:j=350}){const A=(()=>{const d=h.map(u=>u.score),t=Math.max(...d),x=Math.min(...d);return h.map(u=>({...u,isHighest:u.score===t,isLowest:u.score===x,itemStyle:{color:u.score===t?"#10b981":u.score===x?"#ef4444":"rgb(var(--ms-primary-color))"}}))})(),g={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:d=>{const{name:t,value:x,color:u}=d;return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${u}"></div>
              <span class="font-semibold text-text text-sm">${t}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm pr-1">Performance Score: </span>
                <span class="font-mono font-bold text-text text-sm">${x}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},grid:{left:"3%",right:"4%",bottom:"3%",top:"5%",containLabel:!0},xAxis:{type:"category",show:!1,axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}},yAxis:{type:"value",min:0,max:100,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"rgb(var(--ms-text-color)/0.1)",type:"dashed"}},axisLabel:{color:"rgb(var(--ms-text-color)/0.7)",fontSize:12,formatter:"{value}%"}},series:[{name:"Performance Score",type:"bar",barWidth:"60%",itemStyle:{borderRadius:[7,7,0,0],borderWidth:0},label:{show:!0,position:"top",color:"rgb(var(--ms-text-color))",fontSize:12,fontWeight:"bold",formatter:"{c}%"},emphasis:{disabled:!0},data:A.map(d=>({value:d.score,name:d.name,itemStyle:{...d.itemStyle,borderWidth:0},emphasis:d.isHighest||d.isLowest?void 0:{itemStyle:{opacity:.8}}}))}]};return e.jsx("div",{style:{width:M,height:j},children:e.jsx(I,{option:g,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}})})}function Pe({data:h,centerLabel:M,width:j="100%",height:s=400}){const A=h.reduce((t,x)=>t+x.value,0),g=Math.max(...h.map(t=>t.value)),d={tooltip:{trigger:"item",backgroundColor:"transparent",borderWidth:0,renderMode:"html",appendToBody:!0,className:"!shadow-none",formatter:t=>{const x=(t.value/A*100).toFixed(1);return`
          <div class="bg-background border border-border rounded-lg shadow-xl p-3 min-w-[140px] z-999">
            <div class="flex items-center gap-2 mb-2">
              <div class="w-3 h-3 rounded-full" style="background-color: ${t.color}"></div>
              <span class="font-semibold text-text text-sm">${t.name}</span>
            </div>
            <div class="space-y-1">
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Count</span>
                <span class="font-mono font-medium text-text">${t.value.toLocaleString()}</span>
              </div>
              <div class="flex justify-between items-center">
                <span class="text-text/80 text-sm">Percent</span>
                <span class="font-mono font-medium text-text">${x}%</span>
              </div>
            </div>
          </div>
        `}},legend:{show:!1},series:[{type:"pie",radius:["37%","77%"],roseType:"area",emphasis:{scale:!0,scaleSize:10,focus:"self"},itemStyle:{borderWidth:0,borderColor:"#fff"},label:{show:!0,fontSize:14,color:"rgb(var(--ms-text-color))",formatter:({name:t,value:x})=>`${t}
{value|${x.toLocaleString()}}`,rich:{value:{fontSize:24,fontWeight:600,color:"rgb(var(--ms-text-color)/0.7)",padding:[2,0,0,0]}}},labelLine:{show:!0,length:20,length2:10,smooth:!0,lineStyle:{width:1,type:"solid"}},data:h.map(t=>({...t,...t.value===g&&{emphasis:{itemStyle:{shadowBlur:15,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{...t.itemStyle,shadowBlur:8,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0, 0, 0, 0.3)"}}}))}]};return e.jsxs("div",{className:"relative",style:{width:j,height:s},children:[e.jsx(I,{option:d,style:{width:"100%",height:"100%"},opts:{renderer:"svg"}}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none",children:[e.jsx("div",{className:"text-[22px] font-bold text-text",children:A.toLocaleString()}),e.jsx("div",{className:"text-xs text-muted-foreground mt-0",children:M||"Total"})]})]})}function Ie(){var X;const{appName:h,logoUrl:M,logoDarkUrl:j}=le().branding,[s,A]=ne.useState({from:null,to:null}),[g,d]=T.useState([]),[t,x]=T.useState([]),[u,E]=T.useState({}),[O,W]=T.useState(0),k={2:{name:"Fall Alerts",color:"#ef4444"},5:{name:"Device Offline",color:"#f59e0b"}},{data:b,isLoading:a,isError:n,isSuccess:S,error:Y}=ie({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")});T.useEffect(()=>{var w,L;const o=((w=b==null?void 0:b.data)==null?void 0:w.device_uptime)??0,y=((L=b==null?void 0:b.data)==null?void 0:L.device_downtime)??0,f=o+y,i=f>0?Math.round(o/f*100):0;W(i)},[b,S]);const{data:r,isLoading:D,isError:l,isSuccess:v,error:F}=ce({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")});T.useEffect(()=>{var y,f;const o=Array.isArray(r==null?void 0:r.data)&&((y=r==null?void 0:r.data)==null?void 0:y.length)>0?(f=r==null?void 0:r.data)==null?void 0:f.map(i=>{var w,L;return{value:(i==null?void 0:i.count)??0,name:((w=k[i==null?void 0:i._id])==null?void 0:w.name)||"Unknown",itemStyle:{color:((L=k[i==null?void 0:i._id])==null?void 0:L.color)||"#9ca3af"}}}):[{value:0,name:"No Data",itemStyle:{color:"#9ca3af"}}];d(o)},[r,v]);const{data:N,isLoading:H,isError:Ee,error:ke,isSuccess:Fe}=de({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")}),{data:C,isLoading:Ce,isError:_e,isSuccess:K,error:$e}=me({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")});T.useEffect(()=>{var y;const o=(y=C==null?void 0:C.data)==null?void 0:y.map(f=>{const i=(f.countLessThan2Min??0)+(f.countGreaterThan2Min??0),w=i>0?(f.countLessThan2Min??0)/i*100:0;return{name:f.closed_by,score:Math.round(w)}});x(o)},[C,K]);const{data:m,isLoading:Ue,isError:We,isSuccess:ze,error:Be}=fe({to_date:s.from||p().subtract(30,"day").format("YYYY-MM-DD"),from_date:s.to||p().format("YYYY-MM-DD")});function Q(o){if(!o||o.length===0)return 0;const f=o.filter(i=>i.sla_status).length/o.length*100;return Math.round(f*100)/100}const te=he("(max-width: 1366px)"),_=xe(t),ae=o=>o.toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"});return T.useEffect(()=>{var V,J,Z,q,R,ee;const o={companyName:h,startDate:s.from||p().format("YYYY-MM-DD"),endDate:s.to||p().subtract(30,"day").format("YYYY-MM-DD"),totalAlerts:((V=r==null?void 0:r.data)==null?void 0:V.reduce((c,P)=>c+P.count,0))||0,avgResponseTime:ue(((J=b==null?void 0:b.data)==null?void 0:J.avg_res_time)||0),slaCompliance:((Z=(m==null?void 0:m.data)&&Q(m==null?void 0:m.data))==null?void 0:Z.toFixed(2))||"0%",deviceUptime:Math.round(O)+"%"},y=((q=g==null?void 0:g.filter(c=>c.name=="Fall Alerts")[0])==null?void 0:q.value)||0,f=((R=g==null?void 0:g.filter(c=>c.name=="Device Offline")[0])==null?void 0:R.value)||0,i={fall:y,offline:f,total:y+f},w=new Map;(ee=N==null?void 0:N.data)==null||ee.forEach(c=>{const P=new Date(c.year,c.month-1,c.day),z=P.toISOString().split("T")[0],oe=c.event==="5"?"offline":"fall";w.has(z)||w.set(z,{timestamp:P.getTime(),date:ae(P),fall:0,offline:0,total:0});const $=w.get(z);$[oe]+=c.count||0,$.total=$.fall+$.offline});const L=Array.from(w.values()).sort((c,P)=>c.timestamp-P.timestamp);L.forEach(c=>{delete c.timestamp});const se=t==null?void 0:t.map(c=>({...c,score:`${c.score}%`})),re=pe((m==null?void 0:m.data)||[]);E({basicInfo:o,totalAlertOverview:i,alertTrends:L,agentPerformance:se,slaCompliance:re})},[s.to,s.form,r,N,t,K,m]),e.jsxs("div",{className:"mb-6",children:[" ",e.jsxs("div",{id:"customer_heading",className:"flex justify-between sm:flex-row flex-col gap-4 items-center mb-6",children:[e.jsx(Oe,{}),e.jsxs("div",{className:"flex gap-2  items-center",children:[e.jsxs(ge,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(ye,{variant:"tertiary",children:[e.jsx(be,{}),s!=null&&s.from&&(s!=null&&s.to)?`${s.from} - ${s.to}`:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Start Date"})," ",e.jsx(De,{})," ",e.jsx("span",{children:"End Date"})]})]})}),e.jsx(we,{className:"overflow-hidden p-0",align:"end",children:e.jsx(je,{className:"w-full border-border",mode:"range",selected:s,onSelect:o=>{if(!(o!=null&&o.from)||!(o!=null&&o.to)){A({from:null,to:null});return}A({from:p(o.from).format("YYYY-MM-DD"),to:p(o.to).format("YYYY-MM-DD")})},captionLayout:"dropdown",fixedWeeks:!0,showOutsideDays:!0})})]}),e.jsx(Se,{pdfProps:u})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:" items-center justify-between grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4 lg:auto-rows-fr",children:[e.jsx(G,{label:"Total Alerts",value:((X=r==null?void 0:r.data)==null?void 0:X.reduce((o,y)=>o+y.count,0))||0,icon:e.jsx(Ye,{size:20,color:"white"})}),e.jsx(G,{label:"SLA Compliance",value:((m==null?void 0:m.data)&&Q(m==null?void 0:m.data)||0)+"%"||"0%",icon:e.jsx(Me,{size:20,color:"white"})}),e.jsx(G,{label:"Device Uptime",value:Math.round(O)+"%",icon:e.jsx(Ae,{size:20,color:"white"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-2",children:[e.jsx("div",{id:"Total Alert Overview Graph",children:e.jsx(B,{title:e.jsx("h1",{className:"text-lg",children:"Total Alert Overview"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4 !h-full flex items-center justify-center",children:e.jsx(Pe,{data:g,centerLabel:" ",width:"100%",height:te?340:400})})})}),e.jsx("div",{id:"Agent Performance Graph",children:e.jsx(B,{title:e.jsx("h1",{className:"text-lg",children:"Agent Performance"}),headerPadding:"p-4 !text-lg border-none",children:e.jsxs("div",{className:"p-4",children:[e.jsx(Te,{data:t,height:340}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap items-center gap-4 justify-center mt-4",children:[e.jsx(U,{title:"Total Agent",value:_.totalAgents}),e.jsx(U,{title:"Avg. Performance",value:_.averagePerformance+"%"}),e.jsx(U,{title:"Highest Performance",value:_.highestPerformance+"%"}),e.jsx(U,{title:"Lowest Performance",value:_.lowestPerformance+"%"})]})]})})}),e.jsx("div",{id:"Alert Trends Graph",className:"lg:col-span-2",children:e.jsx(B,{title:e.jsx("h1",{className:"text-lg",children:"Alert Trends"}),headerPadding:"p-4 !text-lg border-none",children:e.jsx("div",{className:"p-4",children:e.jsx(Le,{data:N==null?void 0:N.data})})})})]})]})]})}const Oe=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col items-start gap-2 w-full",children:[e.jsx("h1",{className:"text-text sm:text-xl text-lg",children:"Reporting & Analytics"}),e.jsx("div",{className:"opacity-95",children:e.jsx(Ne,{})})]})}),G=({label:h="",value:M="",icon:j})=>e.jsxs("div",{className:"bg-card p-4 flex items-center justify-between gap-3 rounded-md w-full",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:h}),e.jsx("h1",{className:"text-lg font-semibold",children:M})]}),e.jsx("div",{className:"p-2 bg-primary w-fit rounded-md text-lg",children:j})]}),U=({title:h,value:M})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2 ",children:[e.jsxs("div",{className:"p-2 px-3 bg-primary rounded-lg text-white font-medium text-sm",children:[" ",M]}),e.jsxs("div",{className:"rounded-lg text-sm text-wrap",children:[" ",h]})]})});export{Ie as default};
